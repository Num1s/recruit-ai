# Интеграции с внешними платформами

Этот документ описывает систему интеграций с внешними платформами для поиска кандидатов в проекте Recruit.ai.

## Обзор

Система интеграций позволяет:
- Подключаться к внешним платформам (LinkedIn, HH.ru, SuperJob и др.)
- Автоматически искать кандидатов по заданным критериям
- Импортировать найденных кандидатов в основную систему
- Синхронизировать данные в фоновом режиме
- Отслеживать статистику и логи операций

## Поддерживаемые платформы

### LinkedIn
- **Описание**: Профессиональная социальная сеть
- **API**: LinkedIn API (требует одобрения)
- **Возможности**: Поиск по навыкам, опыту, локации
- **Статус**: В разработке

### HH.ru (HeadHunter)
- **Описание**: Крупнейший российский сайт поиска работы
- **API**: HH.ru API
- **Возможности**: Поиск резюме, фильтрация по параметрам
- **Статус**: В разработке

### SuperJob
- **Описание**: Популярная платформа для поиска работы
- **API**: SuperJob API
- **Возможности**: Поиск кандидатов, анализ зарплат
- **Статус**: Планируется

### Лалафо
- **Описание**: Платформа объявлений в Кыргызстане
- **API**: В разработке
- **Возможности**: Поиск местных кандидатов
- **Статус**: Планируется

## Архитектура

### Backend компоненты

#### Модели данных (`app/models/integration.py`)
- `PlatformIntegration` - настройки интеграции с платформой
- `ExternalCandidate` - кандидаты с внешних платформ
- `IntegrationLog` - логи операций интеграции
- `CandidateImport` - история импорта кандидатов

#### Сервисы (`app/services/integration_service.py`)
- `IntegrationService` - основной сервис для работы с интеграциями
- Методы для создания, обновления, удаления интеграций
- Поиск кандидатов на внешних платформах
- Импорт кандидатов в основную систему
- Синхронизация данных

#### API endpoints (`app/api/routes/integrations.py`)
- `GET /api/integrations/` - список интеграций
- `POST /api/integrations/` - создание интеграции
- `PUT /api/integrations/{id}` - обновление интеграции
- `DELETE /api/integrations/{id}` - удаление интеграции
- `POST /api/integrations/search-candidates` - поиск кандидатов
- `POST /api/integrations/import-candidate` - импорт кандидата
- `POST /api/integrations/{id}/sync` - синхронизация

### Frontend компоненты

#### Страницы
- `IntegrationsPage` - главная страница интеграций
- `IntegrationManagement` - управление интеграциями
- `CandidateSearch` - поиск и импорт кандидатов

#### Функциональность
- Создание и настройка интеграций
- Поиск кандидатов с фильтрацией
- Импорт кандидатов в систему
- Просмотр статистики и логов
- Управление синхронизацией

## Установка и настройка

### 1. Установка зависимостей

```bash
cd backend
pip install -r requirements.txt
```

### 2. Создание таблиц базы данных

```bash
python migrate_add_integrations.py
```

### 3. Запуск миграции

```bash
python migrate_add_integrations.py
```

### 4. Тестирование

```bash
python test_integrations.py
```

## Использование

### Создание интеграции

1. Перейдите в раздел "Интеграции" в админ-панели
2. Нажмите "Добавить интеграцию"
3. Выберите платформу (LinkedIn, HH.ru и т.д.)
4. Заполните настройки авторизации (API ключи, токены)
5. Настройте параметры поиска (ключевые слова, локации, опыт)
6. Включите автосинхронизацию при необходимости

### Поиск кандидатов

1. Перейдите на вкладку "Поиск кандидатов"
2. Выберите платформу для поиска
3. Укажите критерии поиска:
   - Ключевые слова (навыки, технологии)
   - Локации
   - Опыт работы (минимальный/максимальный)
   - Зарплатные ожидания
4. Нажмите "Найти кандидатов"
5. Просмотрите результаты и импортируйте подходящих кандидатов

### Импорт кандидатов

1. В результатах поиска нажмите "Импортировать" для нужного кандидата
2. Добавьте заметки к импорту (опционально)
3. Подтвердите импорт
4. Кандидат будет создан в основной системе как пользователь с ролью "candidate"

### Синхронизация

- Автоматическая синхронизация работает по расписанию
- Можно запустить синхронизацию вручную
- Статус синхронизации отображается в интерфейсе
- Ошибки логируются и отображаются в разделе логов

## Безопасность

### Шифрование данных
- API ключи и токены шифруются перед сохранением в базу
- Используется Fernet encryption с ключом из SECRET_KEY
- Расшифровка происходит только при использовании

### Контроль доступа
- Только администраторы могут создавать/удалять интеграции
- Рекрутеры и выше могут искать и импортировать кандидатов
- Все операции логируются

## Мониторинг и логирование

### Логи операций
- Создание/обновление интеграций
- Поиск кандидатов
- Импорт кандидатов
- Синхронизация
- Ошибки и исключения

### Статистика
- Общее количество интеграций
- Активные интеграции
- Найденные кандидаты
- Импортированные кандидаты
- Статистика по платформам

## Разработка новых интеграций

### Добавление новой платформы

1. Добавьте новую платформу в `IntegrationPlatform` enum
2. Реализуйте метод поиска в `IntegrationService._search_on_platform()`
3. Добавьте описание платформы в `_get_platform_description()`
4. Обновите frontend для поддержки новой платформы

### Пример реализации

```python
async def _search_new_platform(self, access_token: str, search_request: SearchCandidatesRequest) -> List[Dict[str, Any]]:
    """Поиск кандидатов на новой платформе"""
    
    # 1. Подготовка запроса к API
    headers = {
        'Authorization': f'Bearer {access_token}',
        'Content-Type': 'application/json'
    }
    
    params = {
        'keywords': ','.join(search_request.keywords or []),
        'locations': ','.join(search_request.locations or []),
        'experience_min': search_request.experience_min,
        'experience_max': search_request.experience_max,
        'limit': search_request.limit
    }
    
    # 2. Выполнение запроса
    response = requests.get('https://api.newplatform.com/candidates', 
                          headers=headers, params=params)
    response.raise_for_status()
    
    # 3. Обработка ответа
    candidates = []
    for item in response.json().get('candidates', []):
        candidate = {
            'external_id': item['id'],
            'platform': IntegrationPlatform.NEW_PLATFORM,
            'first_name': item.get('first_name'),
            'last_name': item.get('last_name'),
            'email': item.get('email'),
            'current_position': item.get('position'),
            'current_company': item.get('company'),
            'experience_years': item.get('experience'),
            'skills': item.get('skills', []),
            'location': item.get('location'),
            'profile_url': item.get('profile_url'),
            'raw_data': item
        }
        candidates.append(candidate)
    
    return candidates
```

## Troubleshooting

### Частые проблемы

1. **Ошибка авторизации**
   - Проверьте правильность API ключей
   - Убедитесь, что токены не истекли
   - Проверьте права доступа к API

2. **Нет результатов поиска**
   - Проверьте параметры поиска
   - Убедитесь, что интеграция активна
   - Проверьте логи на наличие ошибок

3. **Ошибки синхронизации**
   - Проверьте интернет-соединение
   - Убедитесь, что API платформы доступен
   - Проверьте лимиты API

### Логи и отладка

```bash
# Просмотр логов интеграции
curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:8000/api/integrations/1/logs

# Проверка статуса синхронизации
curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:8000/api/integrations/1/sync-status
```

## Roadmap

### Ближайшие планы
- [ ] Реализация LinkedIn API интеграции
- [ ] Интеграция с HH.ru API
- [ ] Добавление SuperJob API
- [ ] Улучшение UI/UX для управления интеграциями
- [ ] Добавление аналитики и отчетов

### Долгосрочные планы
- [ ] Интеграция с международными платформами
- [ ] Машинное обучение для улучшения поиска
- [ ] Автоматическая оценка кандидатов
- [ ] Интеграция с CRM системами
- [ ] Мобильное приложение для рекрутеров

## Поддержка

При возникновении проблем:
1. Проверьте логи в разделе "Интеграции" → "Логи"
2. Убедитесь, что все зависимости установлены
3. Проверьте настройки базы данных
4. Обратитесь к разработчикам с описанием проблемы

---

*Документация обновлена: $(date)*
